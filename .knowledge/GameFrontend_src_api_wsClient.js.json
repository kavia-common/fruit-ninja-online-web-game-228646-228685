{"is_source_file": true, "format": "JavaScript", "description": "Source file implementing a WebSocket client abstraction for the Fruit Ninja Online web game. It manages WebSocket connections with features like auto-reconnect, heartbeat, event subscriptions, mock mode, and environment-based URL resolution.", "external_files": ["process.env (environment variables)", "window.WebSocket (browser WebSocket support)"], "external_methods": ["JSON.parse", "JSON.stringify", "Date.now", "Math.random", "Array.isArray", "console.warn", "console.log", "clearTimeout", "clearInterval", "setTimeout", "setInterval"], "published": ["subscribe", "unsubscribe", "once", "connect", "disconnect", "send", "getStatus", "__setWebSocketImplForTests"], "classes": [], "methods": [{"name": "safeTrim(s)", "description": "Trims whitespace from a string if input is a string; returns empty string otherwise.", "scope": "", "scopeKind": ""}, {"name": "nowMs()", "description": "Returns the current timestamp in milliseconds.", "scope": "", "scopeKind": ""}, {"name": "toArray(x)", "description": "Converts a value to an array if it isn't already one.", "scope": "", "scopeKind": ""}, {"name": "hasWebSocketSupport()", "description": "Checks whether the current environment supports WebSocket.", "scope": "", "scopeKind": ""}, {"name": "resolveWsBaseUrlFromEnv()", "description": "Derives the WebSocket base URL from environment variables or current window location.", "scope": "", "scopeKind": ""}, {"name": "joinUrl(base, path)", "description": "Concatenates a base URL and a path, ensuring proper slashes.", "scope": "", "scopeKind": ""}, {"name": "safeJsonParse(text)", "description": "Safely parses a JSON string, returning null if parsing fails.", "scope": "", "scopeKind": ""}, {"name": "jitterDelay(ms, jitterRatio)", "description": "Calculates a delay with jitter for reconnection backoff.", "scope": "", "scopeKind": ""}, {"name": "createEmitter()", "description": "Creates an event emitter for internal event management, enabling subscription and emission of custom events.", "scope": "", "scopeKind": ""}, {"name": "createMockSocket(emitter)", "description": "Simulates a WebSocket connection for mock mode, echoing messages and emitting open/close events.", "scope": "", "scopeKind": ""}, {"name": "subscribe(eventName, handler)", "description": "Subscribes to WebSocket client events such as open, close, error, message, and custom app events.", "scope": "", "scopeKind": ""}, {"name": "unsubscribe(eventName, handler)", "description": "Unsubscribes from previously subscribed WebSocket client events.", "scope": "", "scopeKind": ""}, {"name": "once(eventName)", "description": "Returns a promise that resolves once when a specified event occurs.", "scope": "", "scopeKind": ""}, {"name": "emitStatus(isMock = false)", "description": "Emits current connection status for UI or monitoring.", "scope": "", "scopeKind": ""}, {"name": "sendFrame(frame)", "description": "Queues or immediately sends a string frame over the WebSocket connection.", "scope": "", "scopeKind": ""}, {"name": "flushQueue()", "description": "Sends all queued messages once the connection is open.", "scope": "", "scopeKind": ""}, {"name": "clearReconnectTimer()", "description": "Clears any scheduled reconnect timeout.", "scope": "", "scopeKind": ""}, {"name": "clearHeartbeatTimer()", "description": "Clears the heartbeat interval timer.", "scope": "", "scopeKind": ""}, {"name": "startHeartbeat()", "description": "Initiates periodic heartbeat pings to detect stale connections.", "scope": "", "scopeKind": ""}, {"name": "scheduleReconnect(reason)", "description": "Schedules a reconnection attempt with exponential backoff and jitter.", "scope": "", "scopeKind": ""}, {"name": "cleanupSocketRefs()", "description": "Removes event handlers from WebSocket or mock socket instances.", "scope": "", "scopeKind": ""}, {"name": "internalConnect(options)", "description": "Handles establishing a WebSocket or mock connection based on environment and configuration.", "scope": "", "scopeKind": ""}, {"name": "connect(options = {})", "description": "Public method to initiate WebSocket connection or switch to mock mode.", "scope": "", "scopeKind": ""}, {"name": "disconnect()", "description": "Public method to disconnect and stop reconnection attempts.", "scope": "", "scopeKind": ""}, {"name": "send(message)", "description": "Public method to send messages over WebSocket; queues if disconnected.", "scope": "", "scopeKind": ""}, {"name": "getStatus()", "description": "Provides a snapshot of current connection status.", "scope": "", "scopeKind": ""}, {"name": "__setWebSocketImplForTests(WebSocketImpl)", "description": "Sets a custom WebSocket implementation for testing purposes.", "scope": "", "scopeKind": ""}, {"name": "getSet(name)", "scope": "createEmitter", "scopeKind": "function", "description": "unavailable"}], "calls": ["safeTrim", "Date.now", "Array.isArray", "JSON.parse", "JSON.stringify", "console.warn", "console.log", "clearTimeout", "clearInterval", "setTimeout", "setInterval", "hasWebSocketSupport", "resolveWsBaseUrlFromEnv", "joinUrl", "safeJsonParse", "jitterDelay", "createEmitter", "createMockSocket", "subscribe", "unsubscribe", "once", "emitStatus", "sendFrame", "flushQueue", "clearReconnectTimer", "clearHeartbeatTimer", "startHeartbeat", "scheduleReconnect", "cleanupSocketRefs", "internalConnect"], "search-terms": ["WebSocket connection management", "auto-reconnect WebSocket", "heartbeat WebSocket", "mock WebSocket mode", "environment URL resolution", "WebSocket event emitter", "reconnection backoff", "WebSocket support check", "WebSocket message queue"], "state": 2, "file_id": 24, "knowledge_revision": 68, "git_revision": "b6ec08cbdbbcad23078faa1d71843c877981146f", "ctags": [{"_type": "tag", "name": "__setWebSocketImplForTests", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function __setWebSocketImplForTests(WebSocketImpl) {$/", "language": "JavaScript", "kind": "function", "signature": "(WebSocketImpl)"}, {"_type": "tag", "name": "cleanupSocketRefs", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function cleanupSocketRefs() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "clearHeartbeatTimer", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function clearHeartbeatTimer() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "clearReconnectTimer", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function clearReconnectTimer() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function connect(options = {}) {$/", "language": "JavaScript", "kind": "function", "signature": "(options = {})"}, {"_type": "tag", "name": "connectOptions", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let connectOptions = \\/** @type {ConnectOptions} *\\/ ({});$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "createEmitter", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function createEmitter() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "createMockSocket", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function createMockSocket(emitter) {$/", "language": "JavaScript", "kind": "function", "signature": "(emitter)"}, {"_type": "tag", "name": "disconnect", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function disconnect() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "emitStatus", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function emitStatus(isMock = false) {$/", "language": "JavaScript", "kind": "function", "signature": "(isMock = false)"}, {"_type": "tag", "name": "explicitlyDisconnected", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let explicitlyDisconnected = false;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "flushQueue", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function flushQueue() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getSet", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^  function getSet(name) {$/", "language": "JavaScript", "kind": "function", "signature": "(name)", "scope": "createEmitter", "scopeKind": "function"}, {"_type": "tag", "name": "getStatus", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function getStatus() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "hasWebSocketSupport", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function hasWebSocketSupport() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "heartbeatTimer", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let heartbeatTimer = \\/** @type {any} *\\/ (null);$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "internalConnect", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function internalConnect(options) {$/", "language": "JavaScript", "kind": "function", "signature": "(options)"}, {"_type": "tag", "name": "jitterDelay", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function jitterDelay(ms, jitterRatio) {$/", "language": "JavaScript", "kind": "function", "signature": "(ms, jitterRatio)"}, {"_type": "tag", "name": "joinUrl", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function joinUrl(base, path) {$/", "language": "JavaScript", "kind": "function", "signature": "(base, path)"}, {"_type": "tag", "name": "lastInboundAt", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let lastInboundAt = 0;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "lastOpenAt", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let lastOpenAt = 0;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "lastUrl", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let lastUrl = \"\";$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "mockWs", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let mockWs = null;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "nowMs", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function nowMs() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "once", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function once(eventName) {$/", "language": "JavaScript", "kind": "function", "signature": "(eventName)"}, {"_type": "tag", "name": "outboundQueue", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let outboundQueue = [];$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "reconnectAttempt", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let reconnectAttempt = 0;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "reconnectTimer", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let reconnectTimer = \\/** @type {any} *\\/ (null);$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "resolveWsBaseUrlFromEnv", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function resolveWsBaseUrlFromEnv() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "safeJsonParse", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function safeJsonParse(text) {$/", "language": "JavaScript", "kind": "function", "signature": "(text)"}, {"_type": "tag", "name": "safeTrim", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function safeTrim(s) {$/", "language": "JavaScript", "kind": "function", "signature": "(s)"}, {"_type": "tag", "name": "scheduleReconnect", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function scheduleReconnect(reason) {$/", "language": "JavaScript", "kind": "function", "signature": "(reason)"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function send(message) {$/", "language": "JavaScript", "kind": "function", "signature": "(message)"}, {"_type": "tag", "name": "sendFrame", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function sendFrame(frame) {$/", "language": "JavaScript", "kind": "function", "signature": "(frame)"}, {"_type": "tag", "name": "shouldReconnect", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let shouldReconnect = true;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "startHeartbeat", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function startHeartbeat() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let state = \"idle\";$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function subscribe(eventName, handler) {$/", "language": "JavaScript", "kind": "function", "signature": "(eventName, handler)"}, {"_type": "tag", "name": "toArray", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^function toArray(x) {$/", "language": "JavaScript", "kind": "function", "signature": "(x)"}, {"_type": "tag", "name": "unsubscribe", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^export function unsubscribe(eventName, handler) {$/", "language": "JavaScript", "kind": "function", "signature": "(eventName, handler)"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/fruit-ninja-online-web-game-228646-228685/GameFrontend/src/api/wsClient.js", "pattern": "/^let ws = null;$/", "language": "JavaScript", "kind": "variable"}], "hash": "4f5e5eedca33fc0bca367d5f8966c4bd", "format-version": 4, "code-base-name": "GameFrontend", "filename": "GameFrontend/src/api/wsClient.js", "fields": [{"name": "let connectOptions = \\/** @type {ConnectOptions} *\\/ ({});", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let explicitlyDisconnected = false;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let heartbeatTimer = \\/** @type {any} *\\/ (null);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let lastInboundAt = 0;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let lastOpenAt = 0;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let lastUrl = \"\";", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let mockWs = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let outboundQueue = [];", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let reconnectAttempt = 0;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let reconnectTimer = \\/** @type {any} *\\/ (null);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let shouldReconnect = true;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let state = \"idle\";", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let ws = null;", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"68": "b6ec08cbdbbcad23078faa1d71843c877981146f"}]}